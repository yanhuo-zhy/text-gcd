2023-11-04 07:32:56,903 - INFO - Training fix_backbone_cub_vit_h with the following settings:
2023-11-04 07:32:56,903 - INFO - Command-line arguments: output_dir=exp
 experiment_name=fix_backbone_cub_vit_h
 seed_num=1
 evaluate=False
 dataset_name=cub
 backbone_name=ViT-B/16
 epochs=200
 base_lr=0.0005
 classifier_lr=0.1
 momentum=0.9
 weight_decay=0.0001
 num_workers=8
 batch_size=128
 prop_train_labels=0.5
 image_size=224
 crop_pct=0.875
 interpolation=3
 transform=imagenet
 alpha_sr=0
 alpha_ri=0.05
 alpha_rs=0.05
 alpha_rd=0.05
 pseudo_ratio=0.6
 lambda_loss=0.2
 coteaching_epoch_t=10
 coteaching_epoch_i=15
 max_kmeans_iter=10
 k_means_init=20
 interrupted_path=
 train_classes=range(0, 100)
 unlabeled_classes=range(100, 200)
 num_labeled_classes=100
 num_unlabeled_classes=100
 num_classes=200
 log_path=exp/11-04-07-32-fix_backbone_cub_vit_h/logs/log.txt
 model_path=exp/11-04-07-32-fix_backbone_cub_vit_h/models/model.pth
 device=cuda
2023-11-04 07:32:56,906 - INFO - Loading CLIP (backbone: ViT-B/16)
2023-11-04 07:32:57,441 - INFO - Loaded hf-hub:laion/CLIP-ViT-H-14-laion2B-s32B-b79K model config.
2023-11-04 07:33:03,216 - INFO - Loading pretrained hf-hub:laion/CLIP-ViT-H-14-laion2B-s32B-b79K weights (/home/zhun.zhong/.cache/huggingface/hub/models--laion--CLIP-ViT-H-14-laion2B-s32B-b79K/snapshots/94a64189c3535c1cb44acfcccd7b0908c1c8eb23/open_clip_pytorch_model.bin).
2023-11-04 07:33:21,316 - INFO - Building custom CLIP
2023-11-04 07:33:22,416 - INFO - Turning off gradients in both the image and the text encoder
2023-11-04 07:33:22,419 - INFO - Parameters that require gradients: ['image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2023-11-04 07:33:22,421 - INFO - Parameters in classifier with big lr: ['image_classifier.weight_g', 'image_classifier.weight_v', 'text_classifier.weight_g', 'text_classifier.weight_v']
2023-11-04 07:33:25,350 - INFO - len of train dataset: 5994
2023-11-04 07:33:25,350 - INFO - len of test dataset: 4494
2023-11-04 07:33:25,350 - INFO - Pseudo Nums: 13
2023-11-04 07:35:36,115 - INFO - len of image_to_class_map: 1552
2023-11-04 07:35:36,116 - INFO - len of image_to_class_map_i: 1797
2023-11-04 07:37:37,297 - INFO - Before Train Accuracies: All 0.0863 | Old 0.0707 | New 0.0942
2023-11-04 07:37:37,297 - INFO - Before Train Accuracies: All 0.0866 | Old 0.0593 | New 0.1002
2023-11-04 07:42:50,817 - INFO - Epoch 1/200, Total Loss: 11.5842, Cls Loss: 9.8485, Cluster Loss: 10.2439, New Loss: 0.0000, Clip tag Loss: 1.4194
2023-11-04 07:42:50,818 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2023-11-04 07:42:50,818 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 07:44:51,246 - INFO - Text classifier Epoch 0 Train Accuracies: All 0.2597 | Old 0.2940 | New 0.2425
2023-11-04 07:44:51,246 - INFO - Image classifier Epoch 0 Train Accuracies: All 0.2007 | Old 0.2687 | New 0.1667
2023-11-04 07:46:52,281 - INFO - Weighted Accuracies: All 0.2161 | Old 0.3260 | New 0.1610
2023-11-04 07:49:03,432 - INFO - len of image_to_class_map: 1983
2023-11-04 07:49:03,433 - INFO - len of image_to_class_map_i: 2147
2023-11-04 07:54:15,098 - INFO - Epoch 2/200, Total Loss: 10.3263, Cls Loss: 8.2533, Cluster Loss: 9.0614, New Loss: 0.0000, Clip tag Loss: 1.4266
2023-11-04 07:54:15,099 - INFO -    Param Group: classifier_head, Learning Rate: 0.1000
2023-11-04 07:54:15,099 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 07:56:15,393 - INFO - Text classifier Epoch 1 Train Accuracies: All 0.2911 | Old 0.3720 | New 0.2505
2023-11-04 07:56:15,393 - INFO - Image classifier Epoch 1 Train Accuracies: All 0.2503 | Old 0.3707 | New 0.1900
2023-11-04 07:58:15,758 - INFO - Weighted Accuracies: All 0.2753 | Old 0.4180 | New 0.2037
2023-11-04 08:00:28,224 - INFO - len of image_to_class_map: 1755
2023-11-04 08:00:28,224 - INFO - len of image_to_class_map_i: 1853
2023-11-04 08:05:40,151 - INFO - Epoch 3/200, Total Loss: 8.4049, Cls Loss: 6.7795, Cluster Loss: 7.0362, New Loss: 0.0000, Clip tag Loss: 1.4200
2023-11-04 08:05:40,152 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2023-11-04 08:05:40,152 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 08:07:40,755 - INFO - Text classifier Epoch 2 Train Accuracies: All 0.3491 | Old 0.5100 | New 0.2685
2023-11-04 08:07:40,755 - INFO - Image classifier Epoch 2 Train Accuracies: All 0.3071 | Old 0.5187 | New 0.2011
2023-11-04 08:09:41,194 - INFO - Weighted Accuracies: All 0.3218 | Old 0.5120 | New 0.2265
2023-11-04 08:11:53,305 - INFO - len of image_to_class_map: 1838
2023-11-04 08:11:53,306 - INFO - len of image_to_class_map_i: 1846
2023-11-04 08:17:04,881 - INFO - Epoch 4/200, Total Loss: 7.2541, Cls Loss: 5.8483, Cluster Loss: 5.8311, New Loss: 0.0000, Clip tag Loss: 1.4195
2023-11-04 08:17:04,881 - INFO -    Param Group: classifier_head, Learning Rate: 0.0999
2023-11-04 08:17:04,881 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 08:19:05,364 - INFO - Text classifier Epoch 3 Train Accuracies: All 0.3554 | Old 0.5560 | New 0.2548
2023-11-04 08:19:05,365 - INFO - Image classifier Epoch 3 Train Accuracies: All 0.3416 | Old 0.5780 | New 0.2231
2023-11-04 08:21:05,790 - INFO - Weighted Accuracies: All 0.3696 | Old 0.5913 | New 0.2585
2023-11-04 08:23:17,302 - INFO - len of image_to_class_map: 1843
2023-11-04 08:23:17,302 - INFO - len of image_to_class_map_i: 1900
2023-11-04 08:28:28,944 - INFO - Epoch 5/200, Total Loss: 6.5940, Cls Loss: 5.3066, Cluster Loss: 5.1611, New Loss: 0.0000, Clip tag Loss: 1.4037
2023-11-04 08:28:28,945 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2023-11-04 08:28:28,945 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 08:30:29,662 - INFO - Text classifier Epoch 4 Train Accuracies: All 0.3870 | Old 0.6013 | New 0.2796
2023-11-04 08:30:29,664 - INFO - Image classifier Epoch 4 Train Accuracies: All 0.3696 | Old 0.6560 | New 0.2261
2023-11-04 08:32:31,091 - INFO - Weighted Accuracies: All 0.3961 | Old 0.6713 | New 0.2582
2023-11-04 08:34:45,035 - INFO - len of image_to_class_map: 1826
2023-11-04 08:34:45,036 - INFO - len of image_to_class_map_i: 1926
2023-11-04 08:39:57,813 - INFO - Epoch 6/200, Total Loss: 6.2260, Cls Loss: 4.9671, Cluster Loss: 4.7658, New Loss: 0.0000, Clip tag Loss: 1.4200
2023-11-04 08:39:57,814 - INFO -    Param Group: classifier_head, Learning Rate: 0.0998
2023-11-04 08:39:57,814 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 08:41:58,398 - INFO - Text classifier Epoch 5 Train Accuracies: All 0.3927 | Old 0.5820 | New 0.2979
2023-11-04 08:41:58,399 - INFO - Image classifier Epoch 5 Train Accuracies: All 0.3914 | Old 0.6700 | New 0.2518
2023-11-04 08:43:59,466 - INFO - Weighted Accuracies: All 0.4186 | Old 0.6553 | New 0.2999
2023-11-04 08:46:14,235 - INFO - len of image_to_class_map: 1904
2023-11-04 08:46:14,236 - INFO - len of image_to_class_map_i: 1940
2023-11-04 08:51:26,399 - INFO - Epoch 7/200, Total Loss: 5.9341, Cls Loss: 4.6898, Cluster Loss: 4.5029, New Loss: 0.0000, Clip tag Loss: 1.3938
2023-11-04 08:51:26,399 - INFO -    Param Group: classifier_head, Learning Rate: 0.0997
2023-11-04 08:51:26,399 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 08:53:27,108 - INFO - Text classifier Epoch 6 Train Accuracies: All 0.4016 | Old 0.6113 | New 0.2966
2023-11-04 08:53:27,109 - INFO - Image classifier Epoch 6 Train Accuracies: All 0.4008 | Old 0.6880 | New 0.2568
2023-11-04 08:55:27,745 - INFO - Weighted Accuracies: All 0.4154 | Old 0.7040 | New 0.2709
2023-11-04 08:57:28,590 - INFO - len of image_to_class_map: 1915
2023-11-04 08:57:28,591 - INFO - len of image_to_class_map_i: 1970
2023-11-04 09:02:41,374 - INFO - Epoch 8/200, Total Loss: 5.7830, Cls Loss: 4.5101, Cluster Loss: 4.3235, New Loss: 0.0000, Clip tag Loss: 1.4222
2023-11-04 09:02:41,375 - INFO -    Param Group: classifier_head, Learning Rate: 0.0996
2023-11-04 09:02:41,375 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 09:04:41,304 - INFO - Text classifier Epoch 7 Train Accuracies: All 0.4261 | Old 0.5967 | New 0.3407
2023-11-04 09:04:41,304 - INFO - Image classifier Epoch 7 Train Accuracies: All 0.4117 | Old 0.6560 | New 0.2892
2023-11-04 09:06:41,940 - INFO - Weighted Accuracies: All 0.4206 | Old 0.7020 | New 0.2796
2023-11-04 09:08:55,364 - INFO - len of image_to_class_map: 1950
2023-11-04 09:08:55,365 - INFO - len of image_to_class_map_i: 1979
2023-11-04 09:14:07,680 - INFO - Epoch 9/200, Total Loss: 5.5771, Cls Loss: 4.3001, Cluster Loss: 4.1374, New Loss: 0.0000, Clip tag Loss: 1.4071
2023-11-04 09:14:07,681 - INFO -    Param Group: classifier_head, Learning Rate: 0.0995
2023-11-04 09:14:07,681 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 09:16:08,200 - INFO - Text classifier Epoch 8 Train Accuracies: All 0.4232 | Old 0.6113 | New 0.3290
2023-11-04 09:16:08,200 - INFO - Image classifier Epoch 8 Train Accuracies: All 0.4152 | Old 0.6647 | New 0.2902
2023-11-04 09:18:09,111 - INFO - Weighted Accuracies: All 0.4217 | Old 0.6833 | New 0.2906
2023-11-04 09:20:23,534 - INFO - len of image_to_class_map: 1843
2023-11-04 09:20:23,535 - INFO - len of image_to_class_map_i: 1953
2023-11-04 09:25:35,532 - INFO - Epoch 10/200, Total Loss: 5.3954, Cls Loss: 4.1432, Cluster Loss: 3.9661, New Loss: 0.0000, Clip tag Loss: 1.3939
2023-11-04 09:25:35,532 - INFO -    Param Group: classifier_head, Learning Rate: 0.0994
2023-11-04 09:25:35,532 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 09:27:36,174 - INFO - Text classifier Epoch 9 Train Accuracies: All 0.4295 | Old 0.6120 | New 0.3380
2023-11-04 09:27:36,174 - INFO - Image classifier Epoch 9 Train Accuracies: All 0.4310 | Old 0.7000 | New 0.2963
2023-11-04 09:29:36,895 - INFO - Weighted Accuracies: All 0.4332 | Old 0.7160 | New 0.2916
2023-11-04 09:31:49,545 - INFO - len of image_to_class_map: 1904
2023-11-04 09:31:49,546 - INFO - len of image_to_class_map_i: 1955
2023-11-04 09:37:01,400 - INFO - Epoch 11/200, Total Loss: 5.3301, Cls Loss: 4.0259, Cluster Loss: 3.8748, New Loss: 0.0000, Clip tag Loss: 1.4251
2023-11-04 09:37:01,401 - INFO -    Param Group: classifier_head, Learning Rate: 0.0993
2023-11-04 09:37:01,401 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 09:39:02,103 - INFO - Text classifier Epoch 10 Train Accuracies: All 0.4588 | Old 0.6253 | New 0.3754
2023-11-04 09:39:02,103 - INFO - Image classifier Epoch 10 Train Accuracies: All 0.4339 | Old 0.6820 | New 0.3096
2023-11-04 09:41:02,012 - INFO - Weighted Accuracies: All 0.4430 | Old 0.7287 | New 0.2999
2023-11-04 09:43:14,650 - INFO - len of image_to_class_map: 1944
2023-11-04 09:43:14,651 - INFO - len of image_to_class_map_i: 2022
2023-11-04 09:48:26,707 - INFO - Epoch 12/200, Total Loss: 8.2906, Cls Loss: 3.6105, Cluster Loss: 4.0002, New Loss: 2.9494, Clip tag Loss: 1.4189
2023-11-04 09:48:26,707 - INFO -    Param Group: classifier_head, Learning Rate: 0.0991
2023-11-04 09:48:26,707 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 09:50:27,257 - INFO - Text classifier Epoch 11 Train Accuracies: All 0.4530 | Old 0.6220 | New 0.3684
2023-11-04 09:50:27,258 - INFO - Image classifier Epoch 11 Train Accuracies: All 0.4555 | Old 0.6833 | New 0.3413
2023-11-04 09:52:27,896 - INFO - Weighted Accuracies: All 0.4947 | Old 0.7187 | New 0.3824
2023-11-04 09:54:42,422 - INFO - len of image_to_class_map: 1969
2023-11-04 09:54:42,423 - INFO - len of image_to_class_map_i: 2099
2023-11-04 09:59:54,097 - INFO - Epoch 13/200, Total Loss: 7.4239, Cls Loss: 3.3043, Cluster Loss: 3.8522, New Loss: 2.2844, Clip tag Loss: 1.3968
2023-11-04 09:59:54,097 - INFO -    Param Group: classifier_head, Learning Rate: 0.0990
2023-11-04 09:59:54,097 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 10:01:54,493 - INFO - Text classifier Epoch 12 Train Accuracies: All 0.4653 | Old 0.6533 | New 0.3711
2023-11-04 10:01:54,494 - INFO - Image classifier Epoch 12 Train Accuracies: All 0.4820 | Old 0.7100 | New 0.3677
2023-11-04 10:03:55,104 - INFO - Weighted Accuracies: All 0.4989 | Old 0.7187 | New 0.3888
2023-11-04 10:06:07,320 - INFO - len of image_to_class_map: 1966
2023-11-04 10:06:07,321 - INFO - len of image_to_class_map_i: 2144
2023-11-04 10:11:19,377 - INFO - Epoch 14/200, Total Loss: 6.9612, Cls Loss: 3.0782, Cluster Loss: 3.7373, New Loss: 1.9416, Clip tag Loss: 1.4141
2023-11-04 10:11:19,377 - INFO -    Param Group: classifier_head, Learning Rate: 0.0988
2023-11-04 10:11:19,377 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 10:13:19,997 - INFO - Text classifier Epoch 13 Train Accuracies: All 0.4875 | Old 0.6520 | New 0.4051
2023-11-04 10:13:19,998 - INFO - Image classifier Epoch 13 Train Accuracies: All 0.5073 | Old 0.7547 | New 0.3834
2023-11-04 10:15:20,594 - INFO - Weighted Accuracies: All 0.5231 | Old 0.7320 | New 0.4185
2023-11-04 10:17:32,823 - INFO - len of image_to_class_map: 2019
2023-11-04 10:17:32,824 - INFO - len of image_to_class_map_i: 2172
2023-11-04 10:22:44,920 - INFO - Epoch 15/200, Total Loss: 6.7225, Cls Loss: 2.9598, Cluster Loss: 3.6666, New Loss: 1.7671, Clip tag Loss: 1.4302
2023-11-04 10:22:44,921 - INFO -    Param Group: classifier_head, Learning Rate: 0.0986
2023-11-04 10:22:44,921 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
2023-11-04 10:24:45,267 - INFO - Text classifier Epoch 14 Train Accuracies: All 0.4786 | Old 0.6507 | New 0.3925
2023-11-04 10:24:45,268 - INFO - Image classifier Epoch 14 Train Accuracies: All 0.5283 | Old 0.7373 | New 0.4235
2023-11-04 10:26:45,685 - INFO - Weighted Accuracies: All 0.5354 | Old 0.7147 | New 0.4456
2023-11-04 10:28:58,397 - INFO - len of image_to_class_map: 2001
2023-11-04 10:28:58,397 - INFO - len of image_to_class_map_i: 2215
2023-11-04 10:34:10,573 - INFO - Epoch 16/200, Total Loss: 6.3479, Cls Loss: 2.8276, Cluster Loss: 3.5614, New Loss: 1.5221, Clip tag Loss: 1.4111
2023-11-04 10:34:10,574 - INFO -    Param Group: classifier_head, Learning Rate: 0.0984
2023-11-04 10:34:10,574 - INFO -    Param Group: base_parameters, Learning Rate: 0.0005
